# avue-form-design 版本升级兼容性深度研究报告

**研究日期：** 2026年1月13日
**项目：** avue-form-design (Vue 2 表单设计器)
**研究目标：** 评估从当前版本升级到目标版本的兼容性风险和影响

---

## 执行摘要

本研究对 avue-form-design 项目的核心架构和关键依赖进行了全面分析，评估了从当前版本升级到目标版本可能遇到的兼容性问题。**总体评估：中等风险，需要谨慎处理**。

**关键发现：**
- ⚠️ **高风险：** axios 0.18.1 → 1.6.7 存在多个 breaking changes
- ⚠️ **中等风险：** Vue 2.6 → 2.7 虽无 breaking changes，但有行为差异
- ✅ **低风险：** Avue 2.10.14 → 2.13.2 无 breaking changes
- ✅ **低风险：** SortableJS 和 Monaco Editor 升级影响较小
- 🔴 **安全风险：** 代码中多处使用 `eval()` 存在安全隐患

---

## 目录

1. [版本升级概览](#版本升级概览)
2. [项目核心架构分析](#项目核心架构分析)
3. [依赖版本变更详细分析](#依赖版本变更详细分析)
4. [兼容性风险评估](#兼容性风险评估)
5. [升级行动计划](#升级行动计划)
6. [推荐升级策略](#推荐升级策略)

---

## 1. 版本升级概览

### 1.1 当前版本（public/index.html）

| 依赖库 | 当前版本 | 目标版本 | 版本跨度 | 风险等级 |
|--------|---------|---------|---------|---------|
| Vue | 2.6.14 | 2.7.16 | Minor | 🟡 中等 |
| Element UI | 2.15.13 | 2.15.14 | Patch | 🟢 低 |
| Avue | 2.10.14 | 2.13.2 | Minor | 🟢 低 |
| axios | 0.18.1 | 1.6.7 | Major | 🔴 高 |
| SortableJS | 1.13.0 | 1.15.6 | Minor | 🟢 低 |

### 1.2 开发依赖

| 依赖库 | package.json 版本 | 说明 |
|--------|------------------|------|
| vuedraggable | ^2.24.3 | 兼容 Vue 2 |
| monaco-editor | ^0.30.1 | 需要验证兼容性 |
| vue-template-compiler | ^2.6.14 | 需升级到 2.7.16 |

---

## 2. 项目核心架构分析

### 2.1 架构概述

**设计模式：** 三栏布局设计器（左侧字段列表 + 中间画布 + 右侧配置面板）

**关键技术栈：**
- **拖拽系统：** vuedraggable (基于 SortableJS)
- **JSON 编辑器：** Monaco Editor (ESM 导入)
- **历史管理：** 自定义 history mixin (最多 20 步)
- **数据转换：** Avue 配置 ↔ 表单设计器配置

### 2.2 核心文件分析

#### 2.2.1 主入口组件 (packages/index.vue)

**关键实现：**
```javascript
// 1. 使用 vuedraggable 实现拖拽
import Draggable from 'vuedraggable'

// 2. 使用 eval() 解析配置（安全风险）
options = eval('(' + options + ')')

// 3. 键盘监听实现撤销/重做
window.addEventListener('keydown', (evt) => {
  if ((evt.metaKey || evt.ctrlKey) && evt.keyCode == 90) {
    // Cmd/Ctrl + Z
  }
})

// 4. 事件中的 this 替换（预览模式）
col[e] = eval((col[e] + '').replace(/this/g, '_this'))
```

**识别的风险点：**
- ❌ 多处使用 `eval()` 存在代码注入风险
- ⚠️ 直接修改事件字符串中的 `this` 引用
- ⚠️ 全局事件监听器未在组件销毁时清理

#### 2.2.2 历史记录机制 (packages/mixins/history.js)

**实现细节：**
```javascript
// 1. 使用 localStorage 持久化
localStorage.setItem("avue-form-history", beautifier(val))

// 2. 使用 eval() 解析历史记录
this.historySteps = eval("(" + history + ")")

// 3. 深拷贝历史快照
return this.deepClone(steps[index])
```

**识别的风险点：**
- ❌ 使用 `eval()` 解析 localStorage 数据（XSS 风险）
- ⚠️ 未对历史记录数据进行验证
- ⚠️ 深拷贝可能影响性能（大数据量）

#### 2.2.3 Monaco Editor 集成 (packages/utils/monaco-editor.js)

**集成方式：**
```javascript
import * as monaco from 'monaco-editor/esm/vs/editor/editor.api';
import 'monaco-editor/esm/vs/basic-languages/javascript/javascript.contribution';
```

**实现特点：**
- ✅ 使用 ESM 导入（现代化）
- ✅ 支持全屏模式和快捷键
- ✅ 自定义编辑器生命周期钩子
- ⚠️ Monaco Editor 0.30.1 与 Vue CLI 4.5.15 存在已知兼容性问题

### 2.3 字段系统架构

**字段配置结构：** (packages/fieldsConfig.js)
- **布局字段：** group, dynamic, title
- **输入字段：** input, textarea, number, password, url, array, img, map
- **选择字段：** radio, checkbox, select, cascader, tree, table
- **上传字段：** upload
- **日期时间字段：** year, month, week, date, time, datetime, daterange 等
- **插件字段：** ueditor (富文本)
- **其他字段：** icon, switch, rate, slider, color

**级联配置机制：**
- select, cascader, tree 支持 `cascaderItem` 属性
- 支持静态数据 (`dicOption: 'static'`) 和远程数据 (`dicOption: 'remote'`)

---

## 3. 依赖版本变更详细分析

### 3.1 Vue 2.6.14 → 2.7.16

#### 3.1.1 版本说明

- **Vue 2.7 是 Vue 2 的最后一个 minor 版本**
- **EOL 时间：** 2023年12月31日（已停止维护）
- **主要变更：** 从 Vue 3 反向移植功能，无 breaking changes

#### 3.1.2 新增特性（反向移植自 Vue 3）

✅ **Composition API 支持：**
```javascript
import { ref, reactive, computed, watch } from 'vue'

export default {
  setup() {
    const count = ref(0)
    const double = computed(() => count.value * 2)
    return { count, double }
  }
}
```

✅ **`<script setup>` 语法：**
```vue
<script setup>
import { ref } from 'vue'
const count = ref(0)
</script>
```

✅ **CSS v-bind：**
```vue
<style scoped>
.text {
  color: v-bind(color);
}
</style>
```

#### 3.1.3 行为差异（注意事项）

⚠️ **响应式系统差异：**
```javascript
// Vue 2.7 使用 Object.defineProperty，Vue 3 使用 Proxy
reactive(foo) === foo  // Vue 2.7: true, Vue 3: false

// Vue 2 的变更检测限制仍然存在：
// 1. 无法检测对象属性的添加/删除
// 2. 无法检测数组索引和长度的变化
// 需要使用 Vue.set() 或 vm.$set()
```

⚠️ **readonly() 行为差异：**
```javascript
// Vue 2.7 创建独立对象，但不会追踪数组新属性
const arr = reactive([])
const roArr = readonly(arr)
arr === roArr  // false
```

#### 3.1.4 未移植的功能

❌ **以下 Vue 3 特性在 2.7 中不可用：**
- `createApp()` - Vue 2 缺少独立应用作用域
- `<script setup>` 中的顶层 `await`
- 模板表达式中的 TypeScript 语法
- Reactivity Transform
- Options API 的 `expose` 选项

#### 3.1.5 升级步骤

**必需的依赖更新：**
```bash
# 1. 升级 Vue 到 2.7.16
npm install vue@^2.7.16

# 2. 移除 vue-template-compiler（不再需要）
npm uninstall vue-template-compiler

# 3. 确保 vue-loader 版本
npm install vue-loader@^15.10.0

# 4. 如果使用 vue-demi
npm install vue-demi@^0.13.1

# 5. 如果使用 @vue/test-utils，需要保留 vue-template-compiler
npm install -D @vue/test-utils
```

**ESLint 配置（如果使用 `<script setup>`）：**
```bash
npm install eslint-plugin-vue@^9
```

#### 3.1.6 对本项目的影响评估

**兼容性评估：** 🟡 **中等风险**

| 影响点 | 当前代码 | Vue 2.7 行为 | 风险级别 |
|--------|---------|-------------|---------|
| 响应式数据 | 使用 `$set` 添加属性 | 继续正常工作 | 🟢 无影响 |
| 事件处理 | 大量使用字符串拼接 | 无影响 | 🟢 无影响 |
| 生命周期 | 标准 Options API | 无影响 | 🟢 无影响 |
| Template | 标准模板语法 | 无影响 | 🟢 无影响 |
| vue-template-compiler | package.json 中引用 | 需要移除 | 🟡 需要调整 |

**推荐行动：**
- ✅ 可以安全升级到 Vue 2.7.16
- ⚠️ 需要移除 vue-template-compiler 依赖
- ⚠️ 需要验证构建流程是否正常
- 💡 可选：重构部分代码使用 Composition API（提升可维护性）

---

### 3.2 Avue 2.10.14 → 2.13.2

#### 3.2.1 版本说明

- **最新版本：** 2.13.2 (2024年11月14日发布)
- **版本跨度：** 2.10.14 → 2.11.x → 2.12.x → 2.13.2
- **Breaking Changes：** ❌ 无

#### 3.2.2 主要新增功能

**2.13.2 版本 (2024-11-14)：**

✅ **新特性：**
- Input 组件新增 `appendClick` 和 `prependClick` 方法，支持文本值参数
- Tree 组件新增 `boxType` 属性

🐛 **Bug 修复：**
- 修复 Crud 组件拖拽排序序号问题
- 修复 Crud 组件行编辑保存失败
- 修复 Crud 组件搜索中 `searchMenuSpan` 无效
- 修复 InputTable 组件单选空分页问题

⚡ **优化：**
- 改进 Crud 组件网格模式加载显示

**2.13.1 版本 (2024-10-14)：**

✅ **新特性：**
- Crud 组件 `before-open` 新增 `loading` 方法
- Time 组件新增 `visibleChange` 方法

🐛 **Bug 修复：**
- Form/Crud `dicData` 字段类型修正
- Crud 列拖拽问题修复
- Select 组件 key 问题修复
- dicData 函数/Promise 执行重复问题修复

**2.13.0 版本 (2024-09-03)：**

✅ **新特性：**
- Form 和 Crud `dicData` 支持 Function 和 Promise 类型
- Form 和 Crud `control` 属性支持 Promise
- DataDisplay 组件新增 `color` 和 `fontColor` 属性

#### 3.2.3 对本项目的影响评估

**兼容性评估：** 🟢 **低风险**

| 影响点 | 说明 | 风险级别 |
|--------|------|---------|
| API 变更 | 无 breaking changes | 🟢 无影响 |
| 新增功能 | 向后兼容 | 🟢 可选使用 |
| Bug 修复 | 修复多个已知问题 | 🟢 有益 |
| dicData 类型 | 新增 Function/Promise 支持 | 🟢 增强功能 |

**推荐行动：**
- ✅ **强烈推荐升级**到 2.13.2
- ✅ 可以利用新的 dicData Function/Promise 特性
- ⚠️ 需要测试 Crud 组件拖拽排序功能
- ⚠️ 需要验证 dicData 相关功能是否正常

**注意事项（CLAUDE.md 中提到）：**
```javascript
// Avue 2.9.13+ 版本中，dynamic 字段的 index option 必须为 true
if (col.type == 'dynamic' && avueVersion() >= '2.9.13') {
  col.children.index = true
}
```

---

### 3.3 axios 0.18.1 → 1.6.7

#### 3.3.1 版本说明

- **版本跨度：** 0.18.1 (2019) → 1.0.0 (2022) → 1.6.7 (2024)
- **Breaking Changes：** ⚠️ **多个重大变更**
- **风险等级：** 🔴 **高风险**

#### 3.3.2 Breaking Changes 详细列表

##### 🔴 1. 导入语法变更

**旧语法 (0.x)：**
```javascript
import { axios } from '@bundled-es-modules/axios'
```

**新语法 (1.x)：**
```javascript
import axios from 'axios'
```

**影响：** 本项目中 axios 通过 CDN 引入，不受影响

---

##### 🔴 2. HTTP 拦截器类型更新

**旧类型 (0.x)：**
```typescript
import { AxiosRequestConfig } from 'axios'

axios.interceptors.request.use(
  (config: AxiosRequestConfig) => config
)
```

**新类型 (1.x)：**
```typescript
import { InternalAxiosRequestConfig } from 'axios'

axios.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => config
)
```

**影响：** 本项目未使用 TypeScript，不受影响

---

##### 🔴 3. 请求头结构变更

**旧结构 (0.x)：**
```javascript
request.headers.common.Authorization = 'Bearer token'
```

**新结构 (1.x)：**
```javascript
request.headers.Authorization = 'Bearer token'
// 不再有 .common 嵌套
```

**影响：** 需要检查项目中是否有 axios 拦截器设置 headers

---

##### 🔴 4. paramsSerializer 配置变更

**旧配置 (0.x)：**
```javascript
axios.get('/api', {
  paramsSerializer: (params) => qs.stringify(params)
})
```

**新配置 (1.0-1.3.4)：**
```javascript
axios.get('/api', {
  paramsSerializer: {
    serialize: (params) => qs.stringify(params)
  }
})
```

**重要：** v1.3.5+ 又恢复支持函数形式

**影响：** 需要检查项目中是否自定义 paramsSerializer

---

##### 🔴 5. URL 查询参数编码问题

**已知 Bug (1.0.0)：**
```javascript
// 这种 URL 在 axios 1.0.0 中会失败
axios.get('https://api.example.com/search?q=test&page=1')

// 错误：URL 中的 ? 和 & 会被错误编码
```

**解决方案：**
- 使用 `params` 选项代替 URL 中的查询参数
- 或升级到 1.1.0+ 版本（已修复）

**影响：** 🔴 **高风险** - 需要全面检查项目中的 axios 调用

---

##### 🔴 6. FormData Content-Type 处理

**变更说明：**
```javascript
// 0.x: 自动设置 multipart/form-data，即使你设置了其他 Content-Type
const formData = new FormData()
axios.post('/upload', formData, {
  headers: { 'Content-Type': 'application/json' }
})
// 0.x: 忽略自定义 Content-Type，使用 multipart/form-data

// 1.x: 尊重自定义 Content-Type
// 1.x: 使用 application/json（可能导致上传失败）
```

**影响：** 需要检查文件上传功能

---

##### 🔴 7. 空字符串 Header 验证

**变更说明：**
```javascript
// 0.x: 允许
axios.get('/api', {
  headers: token && { Authorization: `Bearer ${token}` }
})
// 如果 token 为假值，headers 为 false，不报错

// 1.x: 抛出错误
// TypeError: Cannot read property 'Authorization' of false
```

**推荐写法：**
```javascript
const headers = {}
if (token) {
  headers.Authorization = `Bearer ${token}`
}
axios.get('/api', { headers })
```

**影响：** 需要检查条件性 headers 设置

---

##### 🔴 8. 其他已知问题

- `axios.create()` 在某些上下文中功能异常
- `settle` helper 和其他 `lib/helpers` 内部方法不再导出
- IPv6 地址解析在 Node.js 环境中的变化
- `beforeRedirect` 回调中缺少 headers

#### 3.3.3 对本项目的影响评估

**影响分析：**

1. **CDN 引入方式：**
   ```html
   <!-- public/index.html -->
   <script src="https://unpkg.com/axios@0.18.1/dist/axios.min.js"></script>
   ```
   - 本项目通过 CDN 引入，不是通过 npm
   - 升级方式：修改 CDN URL 即可

2. **项目中 axios 的使用情况：**
   ```bash
   # 需要检查：
   - src/ 目录下是否有 axios 调用
   - 是否有自定义拦截器
   - 是否有自定义 paramsSerializer
   - 是否有文件上传功能
   - 是否有 URL 查询参数
   ```

3. **风险评估：** 🔴 **高风险**

| 风险点 | 可能性 | 影响 | 优先级 |
|--------|-------|------|--------|
| URL 查询参数失败 | 中 | 高 | 🔴 高 |
| 文件上传失败 | 低 | 高 | 🟡 中 |
| Header 设置错误 | 低 | 中 | 🟡 中 |
| paramsSerializer | 低 | 低 | 🟢 低 |

#### 3.3.4 推荐行动计划

**阶段 1：评估（必须）**
```bash
# 1. 搜索项目中所有 axios 使用
grep -r "axios\." src/ examples/
grep -r "axios(" src/ examples/

# 2. 检查是否有查询参数
grep -r "axios.get.*\?" src/

# 3. 检查是否有拦截器
grep -r "interceptors" src/
```

**阶段 2：升级策略**

**选项 A：保守升级（推荐）**
```html
<!-- 升级到 1.7.7（最新的 1.x 稳定版） -->
<script src="https://unpkg.com/axios@1.7.7/dist/axios.min.js"></script>
```

**选项 B：最小化风险（备选）**
```html
<!-- 升级到 1.3.5（修复了主要 bug） -->
<script src="https://unpkg.com/axios@1.3.5/dist/axios.min.js"></script>
```

**阶段 3：测试清单**
- [ ] 测试所有 API 调用
- [ ] 测试带查询参数的 GET 请求
- [ ] 测试文件上传功能
- [ ] 测试错误处理
- [ ] 测试请求/响应拦截器

---

### 3.4 SortableJS 1.13.0 → 1.15.6

#### 3.4.1 版本说明

- **最新版本：** 1.15.6 (2024年11月28日)
- **Breaking Changes：** ❌ 无重大变更
- **风险等级：** 🟢 **低风险**

#### 3.4.2 主要变更

**1.15.6 版本 (2024-11-28)：**
- 恢复文本清除选择行为
- 修复多选拖拽在 iOS 设备上不工作的问题 (#2244)

**1.15.x 系列：**
- 改进拖拽性能
- 修复多个浏览器兼容性问题
- 增强触摸设备支持

#### 3.4.3 对本项目的影响评估

**兼容性评估：** 🟢 **低风险**

| 影响点 | 说明 | 风险级别 |
|--------|------|---------|
| API 变更 | 无 breaking changes | 🟢 无影响 |
| 拖拽功能 | 性能优化 | 🟢 有益 |
| iOS 支持 | 修复已知问题 | 🟢 有益 |

**推荐行动：**
- ✅ **推荐升级**到 1.15.6
- ⚠️ 需要测试拖拽功能在不同设备上的表现
- 💡 特别关注 iOS 设备上的多选拖拽

---

### 3.5 vuedraggable 2.24.3

#### 3.5.1 版本说明

- **当前版本：** 2.24.3 (2020年10月发布)
- **Vue 兼容性：** Vue 2.x
- **依赖：** SortableJS (自动检测版本)
- **状态：** 稳定，但已停止维护（Vue 3 版本为 vue-draggable-next）

#### 3.5.2 与 SortableJS 的兼容性

**兼容性矩阵：**

| vuedraggable 版本 | SortableJS 版本 | Vue 版本 | 兼容性 |
|------------------|----------------|---------|--------|
| 2.24.3 | 1.13.0 | 2.6.14 | ✅ 当前配置 |
| 2.24.3 | 1.15.6 | 2.6.14 | ✅ 兼容 |
| 2.24.3 | 1.15.6 | 2.7.16 | ✅ 兼容 |

**关键点：**
- vuedraggable 2.24.3 与 SortableJS 1.15.6 完全兼容
- vuedraggable 在运行时动态检测 SortableJS 版本
- 不需要升级 vuedraggable 即可升级 SortableJS

#### 3.5.3 项目中的使用方式

**组件导入：**
```javascript
import Draggable from 'vuedraggable'

// 使用示例
<draggable
  :list="data.column"
  :group="{ name: 'form', pull: 'clone', put: false }"
  ghost-class="ghost"
  :sort="false"
  @add="handleWidgetAdd"
  @end="$emit('change')"
>
  <!-- 拖拽内容 -->
</draggable>
```

**使用场景：**
1. 左侧字段列表（只允许 pull clone，不允许 put）
2. 中间画布（允许 add 和排序）
3. 动态子表单（嵌套拖拽）
4. 分组表单（嵌套拖拽）

#### 3.5.4 对本项目的影响评估

**兼容性评估：** 🟢 **低风险**

| 影响点 | 说明 | 风险级别 |
|--------|------|---------|
| Vue 2.7 兼容性 | 完全兼容 | 🟢 无影响 |
| SortableJS 1.15.6 | 完全兼容 | 🟢 无影响 |
| 拖拽功能 | 继续正常工作 | 🟢 无影响 |

**推荐行动：**
- ✅ 保持 vuedraggable 2.24.3 不变
- ✅ 升级 SortableJS 到 1.15.6
- ⚠️ 测试所有拖拽场景
- 💡 未来考虑迁移到 Vue 3 和 vue-draggable-next

---

### 3.6 Monaco Editor 0.30.1

#### 3.6.1 版本说明

- **当前版本：** 0.30.1 (2021年10月)
- **最新版本：** 0.52.0+ (2024)
- **已知问题：** 与 Vue CLI 4.5.15 存在兼容性问题 ([Issue #2903](https://github.com/microsoft/monaco-editor/issues/2903))

#### 3.6.2 集成方式分析

**导入方式：**
```javascript
// packages/utils/monaco-editor.js
import * as monaco from 'monaco-editor/esm/vs/editor/editor.api';
import 'monaco-editor/esm/vs/basic-languages/javascript/javascript.contribution';
```

**特点：**
- ✅ 使用 ESM 导入（现代化）
- ✅ 按需导入语言支持
- ⚠️ 版本较旧（2021年发布）
- ⚠️ 已知 webpack 配置问题

#### 3.6.3 已知兼容性问题

**问题描述：** ([GitHub Issue](https://github.com/microsoft/monaco-editor/issues/2903))
```
Monaco Editor v0.31.1+ 在 Vue CLI v4.5.15 环境下
可能出现模块解析错误或构建失败
```

**影响版本：**
- Monaco Editor 0.31.0+ 引入了一些 webpack 配置变化
- Vue CLI 4.5.15 的 webpack 配置可能不兼容

**解决方案：**
1. **保持当前版本 0.30.1**（推荐）
2. 升级 Vue CLI 到 5.x（需要更多测试）
3. 自定义 webpack 配置以兼容新版本

#### 3.6.4 对本项目的影响评估

**兼容性评估：** 🟡 **中等风险**

| 影响点 | 说明 | 风险级别 |
|--------|------|---------|
| 当前版本 | 0.30.1 稳定运行 | 🟢 无影响 |
| 升级风险 | 可能导致构建失败 | 🔴 高风险 |
| Vue 2.7 兼容性 | 不受 Vue 版本影响 | 🟢 无影响 |
| 功能需求 | 当前版本满足需求 | 🟢 无需升级 |

#### 3.6.5 推荐行动

**策略 1：保持现状（推荐）**
```json
{
  "dependencies": {
    "monaco-editor": "^0.30.1"
  }
}
```
- ✅ 稳定可靠
- ✅ 已验证兼容性
- ❌ 缺少新功能
- ❌ 安全更新延迟

**策略 2：谨慎升级（长期）**
```bash
# 在测试环境中尝试升级
npm install monaco-editor@^0.34.0

# 或使用更稳定的版本
npm install monaco-editor@^0.33.0
```
- ✅ 获得 bug 修复
- ✅ 性能改进
- ⚠️ 需要测试构建流程
- ⚠️ 可能需要调整 webpack 配置

**推荐：** 保持 0.30.1 版本，直到确认新版本稳定性

---

### 3.7 Element UI 2.15.13 → 2.15.14

#### 3.7.1 版本说明

- **版本跨度：** Patch 版本
- **Breaking Changes：** ❌ 无
- **风险等级：** 🟢 **极低风险**

#### 3.7.2 对本项目的影响

**兼容性评估：** 🟢 **极低风险**

- ✅ Patch 版本仅包含 bug 修复
- ✅ 向后完全兼容
- ✅ 无需代码调整

**推荐行动：**
- ✅ **可以直接升级**到 2.15.14
- ⚠️ 简单回归测试即可

---

## 4. 兼容性风险评估

### 4.1 整体风险矩阵

| 依赖库 | 风险等级 | 影响范围 | 测试优先级 | 回滚难度 |
|--------|---------|---------|-----------|---------|
| axios | 🔴 高 | 如果项目使用了 axios | P0 | 容易 |
| Vue | 🟡 中 | 全局 | P1 | 中等 |
| Avue | 🟢 低 | 表单组件 | P2 | 容易 |
| SortableJS | 🟢 低 | 拖拽功能 | P2 | 容易 |
| Monaco Editor | 🟡 中 | JSON 编辑 | P1 | 容易 |
| Element UI | 🟢 低 | UI 组件 | P3 | 容易 |

### 4.2 关键风险点详细分析

#### 4.2.1 🔴 高风险：axios 升级

**风险描述：**
- **概率：** 中到高（取决于项目中 axios 使用情况）
- **影响：** API 调用失败，功能完全不可用
- **检测难度：** 中等（需要全面测试）

**风险场景：**
```javascript
// 场景 1: URL 查询参数（1.0.0 bug，1.1.0+ 已修复）
axios.get('https://api.example.com/search?q=test&page=1')
// 可能失败：URL 编码问题

// 场景 2: 文件上传 Content-Type
axios.post('/upload', formData, {
  headers: { 'Content-Type': 'application/json' }
})
// 0.x: 忽略自定义 Content-Type
// 1.x: 使用自定义 Content-Type（可能导致上传失败）

// 场景 3: 条件性 Headers
headers: token && { Authorization: `Bearer ${token}` }
// 1.x 可能抛出错误
```

**缓解措施：**
1. 升级前全面审查项目中的 axios 使用
2. 优先升级到 1.7.7（最稳定版本）
3. 准备完整的测试用例
4. 准备回滚方案

**回滚方案：**
```html
<!-- 回滚到 0.18.1 -->
<script src="https://unpkg.com/axios@0.18.1/dist/axios.min.js"></script>
```

---

#### 4.2.2 🟡 中等风险：Vue 2.6 → 2.7

**风险描述：**
- **概率：** 低（无 breaking changes）
- **影响：** 构建流程问题、依赖冲突
- **检测难度：** 容易（构建时立即发现）

**风险场景：**
```javascript
// 场景 1: vue-template-compiler 版本不匹配
// Vue 2.7 不再需要 vue-template-compiler
// 但如果 package.json 中有固定版本，可能导致构建失败

// 场景 2: 响应式数据差异
const obj = reactive({})
obj.newProp = 'value'  // Vue 2.7 仍然无法追踪（需要 $set）
```

**缓解措施：**
1. 移除 vue-template-compiler 依赖
2. 确保 vue-loader 版本 >= 15.10.0
3. 测试构建流程
4. 验证所有组件渲染正常

**回滚方案：**
```json
{
  "dependencies": {
    "vue": "2.6.14"
  },
  "devDependencies": {
    "vue-template-compiler": "2.6.14"
  }
}
```

---

#### 4.2.3 🟡 中等风险：Monaco Editor

**风险描述：**
- **概率：** 低（保持当前版本）
- **影响：** 构建失败或 JSON 编辑器不可用
- **检测难度：** 容易（构建时立即发现）

**风险场景：**
```javascript
// 如果升级到 0.31.0+
// 可能出现 webpack 模块解析错误
Module not found: Error: Can't resolve 'monaco-editor/...'
```

**缓解措施：**
1. **保持 0.30.1 版本不变**
2. 如果必须升级，先在测试环境验证
3. 准备 webpack 配置调整方案

---

#### 4.2.4 🔴 安全风险：eval() 使用

**风险描述：**
- **概率：** 高（代码中多处使用）
- **影响：** 代码注入、XSS 攻击
- **检测难度：** 高（需要安全审计）

**风险场景：**
```javascript
// packages/index.vue
options = eval('(' + options + ')')  // 用户输入可能被注入

// packages/mixins/history.js
this.historySteps = eval("(" + history + ")")  // localStorage 数据可能被篡改

// packages/index.vue
col[e] = eval((col[e] + '').replace(/this/g, '_this'))  // 事件代码可能被注入
```

**缓解措施：**
1. 使用 `JSON.parse()` 替代 `eval()`
2. 验证和清理用户输入
3. 实施 Content Security Policy (CSP)
4. 对 localStorage 数据进行签名验证

**推荐修复：**
```javascript
// 错误的做法
options = eval('(' + options + ')')

// 正确的做法
try {
  options = JSON.parse(options)
} catch (e) {
  console.error('Invalid JSON', e)
  options = { column: [] }
}
```

---

### 4.3 测试策略

#### 4.3.1 测试优先级

**P0（关键路径）：**
- [ ] 表单拖拽功能
- [ ] 表单预览功能
- [ ] JSON 导入/导出
- [ ] 历史记录撤销/重做

**P1（核心功能）：**
- [ ] 所有字段类型添加和配置
- [ ] 字段属性编辑
- [ ] 表单全局配置
- [ ] 示例应用运行

**P2（边缘场景）：**
- [ ] 级联字段配置
- [ ] 动态子表单
- [ ] 分组表单
- [ ] 表格选择器

**P3（可选功能）：**
- [ ] 本地存储
- [ ] GitHub Star 按钮
- [ ] Avue 文档链接

#### 4.3.2 测试环境

**浏览器兼容性：**
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

**设备测试：**
- Desktop（Windows/Mac/Linux）
- Mobile（iOS/Android）
- Tablet

#### 4.3.3 自动化测试建议

```javascript
// 建议添加单元测试
describe('History Mixin', () => {
  it('should handle undo/redo correctly', () => {
    // 测试历史记录功能
  })

  it('should not use eval() for parsing', () => {
    // 确保不使用 eval()
  })
})

// 建议添加 E2E 测试
describe('Form Designer', () => {
  it('should drag and drop fields', () => {
    // 测试拖拽功能
  })

  it('should import/export JSON', () => {
    // 测试 JSON 导入导出
  })
})
```

---

## 5. 升级行动计划

### 5.1 升级路线图

```mermaid
graph TD
    A[准备阶段] --> B[评估阶段]
    B --> C[升级阶段]
    C --> D[测试阶段]
    D --> E[部署阶段]

    B -->|发现高风险| F[调整计划]
    D -->|测试失败| C
    F --> B
```

### 5.2 详细步骤

#### 阶段 1：准备阶段（1-2 天）

**1.1 代码审计**
```bash
# 1. 搜索 axios 使用
grep -rn "axios\." src/ examples/ packages/
grep -rn "axios(" src/ examples/ packages/

# 2. 搜索 eval() 使用
grep -rn "eval(" src/ examples/ packages/

# 3. 检查拖拽实现
grep -rn "draggable" src/ examples/ packages/

# 4. 检查 Monaco Editor 使用
grep -rn "monaco" src/ examples/ packages/
```

**1.2 创建测试分支**
```bash
git checkout -b upgrade/dependencies-2026-01
```

**1.3 备份当前配置**
```bash
cp package.json package.json.backup
cp public/index.html public/index.html.backup
```

---

#### 阶段 2：评估阶段（2-3 天）

**2.1 识别 axios 使用情况**

根据代码审计结果，填写以下检查清单：

- [ ] 项目中是否使用了 axios？
  - [ ] 在 src/ 目录
  - [ ] 在 examples/ 目录
  - [ ] 在 packages/ 目录

- [ ] 是否有以下使用场景：
  - [ ] URL 查询参数（`axios.get('url?param=value')`）
  - [ ] 文件上传（`FormData`）
  - [ ] 请求/响应拦截器
  - [ ] 自定义 `paramsSerializer`
  - [ ] 条件性 Headers 设置

**2.2 评估风险等级**

| 发现项 | 风险等级 | 是否需要修改 |
|--------|---------|-------------|
| axios 使用 | 🔴/🟡/🟢 | 是/否 |
| eval() 使用 | 🔴 | 是 |
| 拖拽功能 | 🟢 | 否 |
| Monaco Editor | 🟡 | 否 |

**2.3 制定升级决策**

根据评估结果，选择升级策略：

**策略 A：全面升级（推荐）**
- Vue 2.6.14 → 2.7.16
- Avue 2.10.14 → 2.13.2
- axios 0.18.1 → 1.7.7（如果项目使用了 axios）
- Element UI 2.15.13 → 2.15.14
- SortableJS 1.13.0 → 1.15.6
- Monaco Editor：保持 0.30.1

**策略 B：保守升级（如果风险高）**
- Vue：保持 2.6.14（或升级到 2.7.16）
- Avue 2.10.14 → 2.13.2
- axios：保持 0.18.1（或升级到 1.3.5）
- Element UI 2.15.13 → 2.15.14
- SortableJS 1.13.0 → 1.15.6
- Monaco Editor：保持 0.30.1

**策略 C：最小化升级（如果时间紧迫）**
- 仅升级 Avue 和 Element UI
- 其他依赖保持不变

---

#### 阶段 3：升级阶段（1-2 天）

**3.1 修改 public/index.html**

```html
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">

  <!-- Element UI -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.14/lib/theme-chalk/index.css">

  <!-- Avue -->
  <link rel="stylesheet" href="https://unpkg.com/@smallwei/avue@2.13.2/lib/index.css">

  <link rel="stylesheet" href="<%= BASE_URL %>css/home.css">
  <title>Avue表单设计器</title>
</head>

<body>
  <noscript>
    <strong>很抱歉，如果没有 JavaScript 支持，表单设计器 将不能正常工作。请启用浏览器的 JavaScript 然后继续。</strong>
  </noscript>
  <div id="app">
    <div class="avue-home">
      <div class="avue-home__main">
        <img class="avue-home__loading" src="./img/loading-spin.svg" alt="loading">
        <div class="avue-home__title">正在加载资源</div>
        <div class="avue-home__sub-title">初次加载资源可能需要较多时间 请耐心等待</div>
      </div>
    </div>
  </div>

  <!-- Vue 2.7.16 -->
  <script src="https://unpkg.com/vue@2.7.16/dist/vue.js" charset="utf-8"></script>

  <!-- Element UI 2.15.14 -->
  <script src="https://unpkg.com/element-ui@2.15.14/lib/index.js" charset="utf-8"></script>

  <!-- Avue 2.13.2 -->
  <script src="https://unpkg.com/@smallwei/avue@2.13.2" charset="utf-8"></script>

  <!-- axios 1.7.7（如果项目使用） -->
  <script src="https://unpkg.com/axios@1.7.7/dist/axios.min.js" charset="utf-8"></script>

  <!-- 高德地图 -->
  <script type="text/javascript"
    src='https://webapi.amap.com/maps?v=1.4.11&key=a40c6d547150ac9c43cc17cc0a95f324&plugin=AMap.PlaceSearch'></script>
  <script src="https://webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>

  <!-- SortableJS 1.15.6 -->
  <script src="https://unpkg.com/sortablejs@1.15.6/Sortable.min.js"></script>

</body>
</html>
```

**3.2 修改 package.json**

```json
{
  "name": "@sscfaith/avue-form-design",
  "version": "1.5.6",
  "dependencies": {
    "monaco-editor": "^0.30.1",
    "vuedraggable": "^2.24.3"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "^4.5.15",
    "@vue/cli-plugin-eslint": "^4.5.15",
    "@vue/cli-service": "^4.5.15",
    "avue-plugin-ueditor": "^0.2.3",
    "babel-eslint": "^10.1.0",
    "core-js": "^3.17.2",
    "eslint": "^7.32.0",
    "eslint-plugin-vue": "^6.2.2",
    "sass": "^1.49.9",
    "sass-loader": "^7.3.1"
    // 注意：移除了 vue-template-compiler
  }
}
```

**3.3 安装依赖**

```bash
# 清除缓存
rm -rf node_modules package-lock.json

# 重新安装
npm install
```

**3.4 修复 eval() 安全问题（强烈推荐）**

**修改 packages/index.vue：**

```javascript
// 替换第 367-372 行
// 旧代码：
/*
if (typeof options == 'string') {
  try {
    options = eval('(' + options + ')')
  } catch (e) {
    console.error('非法配置')
    options = { column: [] }
  }
}
*/

// 新代码：
if (typeof options == 'string') {
  try {
    options = JSON.parse(options)
  } catch (e) {
    console.error('非法配置，无法解析 JSON', e)
    options = { column: [] }
  }
}

// 替换第 449-455 行
// 旧代码：
/*
if (typeof options == 'string') {
  try {
    options = eval('(' + options + ')')
  } catch (e) {
    console.error('非法配置')
    options = { column: [] }
  }
}
*/

// 新代码：
if (typeof options == 'string') {
  try {
    options = JSON.parse(options)
  } catch (e) {
    console.error('非法配置，无法解析 JSON', e)
    options = { column: [] }
  }
}

// 替换第 695 行
// 旧代码：
// if (typeof obj == 'string') obj = eval('(' + obj + ')')

// 新代码：
if (typeof obj == 'string') {
  try {
    obj = JSON.parse(obj)
  } catch (e) {
    console.error('无法解析 JSON', e)
    obj = { column: [] }
  }
}
```

**修改 packages/mixins/history.js：**

```javascript
// 替换第 28 行
// 旧代码：
// this.historySteps = eval("(" + history + ")")

// 新代码：
try {
  this.historySteps = JSON.parse(history)
} catch (e) {
  console.error('无法解析历史记录', e)
  // 清除损坏的历史记录
  localStorage.removeItem("avue-form-history")
  this.historySteps = data
}
```

**注意：** 事件代码中的 `eval()` (第 615-617 行) 更难处理，需要更复杂的解决方案（如使用 Function constructor + CSP）。

---

#### 阶段 4：测试阶段（3-5 天）

**4.1 构建测试**

```bash
# 开发模式
npm run serve
# 验证：http://localhost:8080 是否正常打开

# 构建生产版本
npm run build
# 验证：dist/ 目录是否生成

# 构建组件库
npm run lib
# 验证：lib/ 目录是否生成
```

**4.2 功能测试清单**

**P0 功能测试：**
- [ ] 左侧字段列表显示正常
- [ ] 可以拖拽字段到中间画布
- [ ] 拖拽后字段显示正常
- [ ] 可以选中字段并显示配置面板
- [ ] 可以修改字段属性
- [ ] 可以删除字段
- [ ] 可以复制字段
- [ ] 撤销（Cmd/Ctrl + Z）功能正常
- [ ] 重做（Cmd/Ctrl + Shift + Z）功能正常
- [ ] 导入 JSON 功能正常
- [ ] 生成 JSON 功能正常
- [ ] 预览功能正常
- [ ] 清空功能正常

**P1 功能测试：**
- [ ] 所有字段类型都可以添加
  - [ ] 布局字段（group, dynamic, title）
  - [ ] 输入字段（input, textarea, number, password 等）
  - [ ] 选择字段（radio, checkbox, select, cascader, tree, table）
  - [ ] 上传字段（upload）
  - [ ] 日期时间字段（year, month, date, datetime 等）
  - [ ] 其他字段（icon, switch, rate, slider, color）
- [ ] 字段属性配置面板显示正常
- [ ] 表单全局配置面板显示正常
- [ ] JSON 编辑器（Monaco Editor）显示正常
- [ ] JSON 编辑器语法高亮正常
- [ ] JSON 编辑器自动格式化正常

**P2 功能测试：**
- [ ] 级联字段配置正常
  - [ ] select 级联配置
  - [ ] cascader 级联配置
  - [ ] tree 级联配置
- [ ] 动态子表单（dynamic）正常
  - [ ] 可以添加子字段
  - [ ] 可以配置子字段
  - [ ] 预览时子表单正常
- [ ] 分组表单（group）正常
  - [ ] 可以添加分组
  - [ ] 可以添加分组内字段
  - [ ] 预览时分组正常
- [ ] 表格选择器（table）配置正常

**P3 功能测试：**
- [ ] 本地存储功能正常
- [ ] GitHub Star 按钮显示正常
- [ ] Avue 文档链接正常
- [ ] 自定义字段支持正常

**4.3 浏览器兼容性测试**

| 浏览器 | 版本 | 测试结果 | 问题描述 |
|--------|------|---------|---------|
| Chrome | 最新 | ✅/❌ | |
| Firefox | 最新 | ✅/❌ | |
| Safari | 最新 | ✅/❌ | |
| Edge | 最新 | ✅/❌ | |

**4.4 性能测试**

- [ ] 添加 50 个字段后性能正常
- [ ] 添加 100 个字段后性能正常
- [ ] 撤销/重做性能正常
- [ ] JSON 导入/导出性能正常
- [ ] 内存占用正常（无内存泄漏）

**4.5 回归测试**

- [ ] 示例应用正常运行
- [ ] 所有示例表单都可以正常导入
- [ ] 历史项目的配置可以正常导入

---

#### 阶段 5：部署阶段（1 天）

**5.1 代码审查**

```bash
# 查看所有变更
git diff master..upgrade/dependencies-2026-01

# 创建 Pull Request
# 请求团队成员审查
```

**5.2 文档更新**

创建升级文档：`docs/UPGRADE_GUIDE_2026.md`

```markdown
# 依赖升级指南 (2026-01)

## 变更摘要
- Vue: 2.6.14 → 2.7.16
- Avue: 2.10.14 → 2.13.2
- Element UI: 2.15.13 → 2.15.14
- SortableJS: 1.13.0 → 1.15.6
- axios: 0.18.1 → 1.7.7（如果使用）

## 使用者注意事项
1. Vue 2.7 新增 Composition API 支持
2. Avue 2.13.x 新增 dicData Function/Promise 支持
3. 如果使用了 axios，需要注意 URL 查询参数写法

## 开发者注意事项
1. 移除了 vue-template-compiler 依赖
2. 修复了多处 eval() 安全问题
3. 构建流程保持不变

## 回滚方案
见 public/index.html.backup 和 package.json.backup
```

**5.3 创建发布版本**

```bash
# 合并到主分支
git checkout master
git merge upgrade/dependencies-2026-01

# 打标签
git tag -a v1.6.0 -m "升级核心依赖到最新稳定版本"

# 推送
git push origin master --tags
```

**5.4 发布 npm 包（如果需要）**

```bash
# 构建
npm run lib

# 发布
npm publish
```

---

### 5.3 回滚计划

**如果升级后出现严重问题，按以下步骤回滚：**

**步骤 1：恢复文件**
```bash
cp public/index.html.backup public/index.html
cp package.json.backup package.json
```

**步骤 2：重新安装依赖**
```bash
rm -rf node_modules package-lock.json
npm install
```

**步骤 3：重新构建**
```bash
npm run serve  # 验证开发模式
npm run build  # 验证生产构建
npm run lib    # 验证组件库构建
```

**步骤 4：验证功能**
- 测试关键功能是否恢复正常
- 检查是否有遗留问题

---

## 6. 推荐升级策略

### 6.1 综合建议

基于全面的研究和风险评估，我们提供以下升级策略：

#### 策略 A：渐进式升级（强烈推荐）

**第一阶段（低风险）：**
```bash
# 升级低风险依赖
- Avue: 2.10.14 → 2.13.2
- Element UI: 2.15.13 → 2.15.14
- SortableJS: 1.13.0 → 1.15.6
```

**第二阶段（中等风险）：**
```bash
# 升级 Vue
- Vue: 2.6.14 → 2.7.16
- 移除 vue-template-compiler
```

**第三阶段（高风险，可选）：**
```bash
# 如果项目使用 axios，在充分测试后升级
- axios: 0.18.1 → 1.7.7
```

**第四阶段（代码质量提升）：**
```bash
# 修复 eval() 安全问题
# 添加单元测试和 E2E 测试
```

#### 策略 B：一次性升级（如果资源充足）

- 在测试环境一次性升级所有依赖
- 进行 5-7 天的全面测试
- 确认无问题后部署到生产环境

#### 策略 C：保守策略（如果时间紧迫）

- 仅升级 Avue 和 Element UI
- 其他依赖保持不变
- 在未来有充足时间时再进行全面升级

---

### 6.2 最终推荐配置

**推荐的 public/index.html：**

```html
<!-- Vue 2.7.16 - 稳定且向后兼容 -->
<script src="https://unpkg.com/vue@2.7.16/dist/vue.js"></script>

<!-- Element UI 2.15.14 - 最新补丁版本 -->
<link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.14/lib/theme-chalk/index.css">
<script src="https://unpkg.com/element-ui@2.15.14/lib/index.js"></script>

<!-- Avue 2.13.2 - 修复了多个问题 -->
<link rel="stylesheet" href="https://unpkg.com/@smallwei/avue@2.13.2/lib/index.css">
<script src="https://unpkg.com/@smallwei/avue@2.13.2"></script>

<!-- axios 1.7.7 - 最稳定的 1.x 版本（如果项目使用） -->
<script src="https://unpkg.com/axios@1.7.7/dist/axios.min.js"></script>

<!-- SortableJS 1.15.6 - 修复了 iOS 问题 -->
<script src="https://unpkg.com/sortablejs@1.15.6/Sortable.min.js"></script>
```

**推荐的 package.json：**

```json
{
  "dependencies": {
    "monaco-editor": "^0.30.1",
    "vuedraggable": "^2.24.3"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "^4.5.15",
    "@vue/cli-plugin-eslint": "^4.5.15",
    "@vue/cli-service": "^4.5.15",
    "babel-eslint": "^10.1.0",
    "core-js": "^3.17.2",
    "eslint": "^7.32.0",
    "eslint-plugin-vue": "^6.2.2",
    "sass": "^1.49.9",
    "sass-loader": "^7.3.1"
  }
}
```

---

### 6.3 长期规划建议

#### 6.3.1 技术债务清理

1. **移除 eval() 使用（高优先级）**
   - 替换为 `JSON.parse()`
   - 实施 Content Security Policy

2. **添加测试覆盖（中优先级）**
   - 单元测试（Jest + Vue Test Utils）
   - E2E 测试（Cypress 或 Playwright）

3. **代码质量提升（中优先级）**
   - ESLint 规则加强
   - TypeScript 支持（可选）
   - 代码格式化（Prettier）

#### 6.3.2 未来升级路径

**选项 1：迁移到 Vue 3（长期）**
- 需要重写大量代码
- vuedraggable → vue-draggable-next
- Avue → Avue 3.x
- Element UI → Element Plus

**选项 2：保持 Vue 2（中期）**
- 持续维护当前技术栈
- 定期更新依赖安全补丁
- 关注 Vue 2 EOL 影响

---

### 6.4 关键决策点

**决策 1：是否升级 axios？**

- **如果项目不使用 axios**：可以忽略此升级
- **如果项目使用 axios**：
  - 先评估使用情况（见 3.3.4）
  - 如果风险可控，升级到 1.7.7
  - 如果风险高，保持 0.18.1 或升级到 1.3.5

**决策 2：是否修复 eval() 问题？**

- **强烈推荐修复**（安全风险）
- 修复难度：中等
- 修复收益：显著提升安全性

**决策 3：是否添加测试？**

- **长期推荐**（代码质量）
- 投入成本：高
- 长期收益：提升可维护性和稳定性

---

## 7. 总结

### 7.1 核心发现

1. **项目架构良好**：三栏设计器模式清晰，模块化程度高
2. **主要依赖稳定**：大部分依赖升级风险较低
3. **axios 需谨慎**：如果项目使用 axios，需要特别关注
4. **安全问题突出**：代码中多处使用 eval() 存在安全隐患

### 7.2 升级收益

- ✅ 获得最新的 bug 修复和性能优化
- ✅ Avue 2.13.2 新增 dicData Function/Promise 支持
- ✅ Vue 2.7 提供 Composition API（可选使用）
- ✅ SortableJS 1.15.6 修复 iOS 拖拽问题
- ✅ 提升整体安全性（修复 eval() 问题）

### 7.3 升级风险

- ⚠️ axios 升级可能导致 API 调用失败（如果项目使用）
- ⚠️ Vue 2.7 升级可能导致构建流程问题
- ⚠️ 需要充分的测试时间（3-5 天）
- ⚠️ 需要准备回滚方案

### 7.4 最终建议

**立即行动：**
1. 升级 Avue 到 2.13.2
2. 升级 Element UI 到 2.15.14
3. 升级 SortableJS 到 1.15.6
4. 修复 eval() 安全问题

**谨慎评估：**
1. 升级 Vue 到 2.7.16（建议升级）
2. 升级 axios 到 1.7.7（需先评估使用情况）

**长期规划：**
1. 添加单元测试和 E2E 测试
2. 实施 Content Security Policy
3. 评估 Vue 3 迁移路径

---

## 附录

### 附录 A：参考资源

**官方文档：**
- [Vue 2.7 迁移指南](https://v2.vuejs.org/v2/guide/migration-vue-2-7.html)
- [Avue 文档](https://avuejs.com/)
- [axios GitHub](https://github.com/axios/axios)
- [SortableJS GitHub](https://github.com/SortableJS/Sortable)
- [vuedraggable GitHub](https://github.com/SortableJS/Vue.Draggable)
- [Monaco Editor GitHub](https://github.com/microsoft/monaco-editor)

**社区资源：**
- [axios 1.0.0 迁移指南（社区）](https://github.com/bmuenzenmeyer/axios-1.0.0-migration-guide)
- [Vue 2 EOL 公告](https://v2.vuejs.org/eol/)

---

### 附录 B：问题排查指南

**问题 1：构建失败**
```bash
# 症状：npm run serve 或 npm run build 失败
# 可能原因：vue-template-compiler 版本不匹配
# 解决方案：
npm uninstall vue-template-compiler
rm -rf node_modules package-lock.json
npm install
```

**问题 2：拖拽不工作**
```bash
# 症状：无法拖拽字段
# 可能原因：SortableJS 版本不兼容
# 解决方案：
# 检查 public/index.html 中 SortableJS CDN URL
# 确保版本为 1.15.6
```

**问题 3：axios 调用失败**
```bash
# 症状：API 请求失败或返回错误
# 可能原因：axios 1.x breaking changes
# 解决方案：
# 1. 检查是否使用了 URL 查询参数
# 2. 检查是否有条件性 Headers
# 3. 检查是否有 FormData 上传
# 4. 考虑回滚到 axios 0.18.1
```

**问题 4：Monaco Editor 不显示**
```bash
# 症状：JSON 编辑器区域空白
# 可能原因：webpack 配置问题
# 解决方案：
# 保持 monaco-editor 版本为 0.30.1
# 检查浏览器控制台是否有错误
```

---

### 附录 C：测试用例模板

```javascript
// 示例测试用例
describe('Form Designer - Drag and Drop', () => {
  it('should drag field from left panel to canvas', () => {
    // 1. 模拟拖拽开始
    // 2. 模拟拖拽到画布
    // 3. 验证字段已添加到画布
  })

  it('should update field config in right panel', () => {
    // 1. 选中字段
    // 2. 修改右侧配置
    // 3. 验证字段配置已更新
  })

  it('should undo/redo correctly', () => {
    // 1. 添加字段
    // 2. 执行撤销
    // 3. 验证字段已移除
    // 4. 执行重做
    // 5. 验证字段已恢复
  })
})
```

---

### 附录 D：变更日志

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| 1.0 | 2026-01-13 | 初始版本，完成全面研究和评估 |

---

**报告结束**

本报告由 Claude Code 生成，基于对 avue-form-design 项目的深度研究和外部版本变更调研。建议定期更新本报告以反映最新的依赖状态和安全建议。
